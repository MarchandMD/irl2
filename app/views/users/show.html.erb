<div class="w-full">
  <%
    # Group-specific styling and information
    group_info = {
      'Urban Nomads' => {
        icon: 'üèôÔ∏è',
        tagline: 'Wanderer of concrete jungles',
        color: 'emerald',
        text_class: 'text-emerald-600',
        text_class_dark: 'dark:text-emerald-400',
        hover_class: 'hover:text-emerald-700 dark:hover:text-emerald-300',
        border_class: 'border-emerald-500',
        gradient: 'from-emerald-500 to-teal-500'
      },
      'Digital Alchemists' => {
        icon: '‚öóÔ∏è',
        tagline: 'Transforming bits into experiences',
        color: 'purple',
        text_class: 'text-purple-600',
        text_class_dark: 'dark:text-purple-400',
        hover_class: 'hover:text-purple-700 dark:hover:text-purple-300',
        border_class: 'border-purple-500',
        gradient: 'from-purple-500 to-pink-500'
      },
      'Street Philosophers' => {
        icon: 'üí≠',
        tagline: 'Seeking wisdom in urban spaces',
        color: 'blue',
        text_class: 'text-blue-600',
        text_class_dark: 'dark:text-blue-400',
        hover_class: 'hover:text-blue-700 dark:hover:text-blue-300',
        border_class: 'border-blue-500',
        gradient: 'from-blue-500 to-cyan-500'
      },
      'Midnight Architects' => {
        icon: 'üåô',
        tagline: 'Building dreams after dark',
        color: 'indigo',
        text_class: 'text-indigo-600',
        text_class_dark: 'dark:text-indigo-400',
        hover_class: 'hover:text-indigo-700 dark:hover:text-indigo-300',
        border_class: 'border-indigo-500',
        gradient: 'from-indigo-500 to-purple-500'
      },
      'Concrete Poets' => {
        icon: '‚úçÔ∏è',
        tagline: 'Writing verses on city walls',
        color: 'orange',
        text_class: 'text-orange-600',
        text_class_dark: 'dark:text-orange-400',
        hover_class: 'hover:text-orange-700 dark:hover:text-orange-300',
        border_class: 'border-orange-500',
        gradient: 'from-orange-500 to-red-500'
      }
    }
    info = group_info[@user.group] || {
      icon: 'üë§',
      tagline: 'Explorer',
      color: 'gray',
      text_class: 'text-gray-600',
      text_class_dark: 'dark:text-gray-400',
      hover_class: 'hover:text-gray-700 dark:hover:text-gray-300',
      border_class: 'border-gray-500',
      gradient: 'from-gray-500 to-gray-600'
    }
  %>

  <!-- Profile Header -->
  <div class="bg-gradient-to-r <%= info[:gradient] %> rounded-2xl p-8 mb-8 shadow-lg">
    <div class="flex items-start gap-6">
      <!-- Avatar -->
      <div class="flex-shrink-0 w-32 h-32 bg-white rounded-full flex items-center justify-center <%= info[:text_class] %> text-5xl font-bold shadow-xl border-4 border-white">
        <%= @user.email[0].upcase %>
      </div>

      <!-- Profile Info -->
      <div class="flex-1 text-white">
        <div class="flex items-center gap-3 mb-2">
          <h1 class="text-4xl font-black uppercase tracking-tight">
            <%= @user.email.split('@').first %>
          </h1>
          <span class="text-4xl"><%= info[:icon] %></span>
        </div>
        <p class="text-xl text-white/90 italic mb-4"><%= info[:tagline] %></p>

        <% if @user.group.present? %>
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full">
            <span class="font-bold uppercase tracking-wide text-sm">Member of <%= @user.group %></span>
          </div>
        <% end %>

        <div class="mt-4 flex items-center gap-6 text-white/80 text-sm">
          <div class="flex items-center gap-1">
            <span>üìÖ</span>
            <span>Joined <%= @user.created_at.strftime("%B %Y") %></span>
          </div>
          <div class="flex items-center gap-1">
            <span>‚è±Ô∏è</span>
            <span>Active for <%= time_ago_in_words(@user.created_at) %></span>
          </div>
        </div>
      </div>

      <!-- Edit Button (only for own profile) -->
      <% if user_signed_in? && current_user.id == @user.id %>
        <div class="flex-shrink-0">
          <%= link_to "‚öôÔ∏è Settings", edit_user_registration_path, class: "px-4 py-2 bg-white #{info[:text_class]} font-bold text-sm uppercase tracking-wider hover:bg-white/90 transition rounded-lg shadow" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Back to Community Link -->
  <div class="mb-6">
    <%= link_to users_path, class: "inline-flex items-center gap-2 #{info[:text_class]} #{info[:text_class_dark]} #{info[:hover_class]} font-semibold text-sm uppercase tracking-wide transition" do %>
      ‚Üê Back to Community
    <% end %>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
      <div class="text-4xl font-black <%= info[:text_class] %> <%= info[:text_class_dark] %>"><%= @tasks.count %></div>
      <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide mt-1">Total Tasks</div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
      <div class="text-4xl font-black text-green-600 dark:text-green-400"><%= @completed_tasks.count %></div>
      <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide mt-1">Completed</div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
      <div class="text-4xl font-black text-emerald-600 dark:text-emerald-400"><%= @tasks.sum(:upvotes_count) %></div>
      <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide mt-1">Total Upvotes</div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
      <div class="text-4xl font-black text-blue-600 dark:text-blue-400"><%= @tasks.sum(:submissions_count) %></div>
      <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide mt-1">Submissions</div>
    </div>
  </div>

  <!-- Activity Overview -->
  <div class="mb-8">
    <h2 class="text-2xl font-black uppercase tracking-tight text-gray-900 dark:text-white mb-4">Activity Overview</h2>
    <div class="grid md:grid-cols-3 gap-4">
      <div class="bg-white dark:bg-gray-800 p-5 rounded-lg border-l-4 border-green-500">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-bold text-gray-900 dark:text-white"><%= @open_tasks.count %></div>
            <div class="text-sm text-gray-600 dark:text-gray-400 uppercase">Open Tasks</div>
          </div>
          <div class="text-3xl">üü¢</div>
        </div>
      </div>
      <div class="bg-white dark:bg-gray-800 p-5 rounded-lg border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-bold text-gray-900 dark:text-white"><%= @in_progress_tasks.count %></div>
            <div class="text-sm text-gray-600 dark:text-gray-400 uppercase">In Progress</div>
          </div>
          <div class="text-3xl">üîµ</div>
        </div>
      </div>
      <div class="bg-white dark:bg-gray-800 p-5 rounded-lg border-l-4 <%= info[:border_class] %>">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-bold text-gray-900 dark:text-white">
              <%= @completed_tasks.count > 0 ? ((@completed_tasks.count.to_f / @tasks.count) * 100).round : 0 %>%
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400 uppercase">Completion Rate</div>
          </div>
          <div class="text-3xl">üìä</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Status Filter -->
  <div class="mb-6 flex items-center gap-4 flex-wrap">
    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide">Filter:</span>
    <button id="filterAll" class="filter-btn active px-4 py-2 bg-gray-900 dark:bg-gray-700 text-white font-medium text-sm uppercase tracking-wider rounded transition">
      All (<%= @tasks.count %>)
    </button>
    <button id="filterOpen" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-medium text-sm uppercase tracking-wider rounded hover:bg-gray-300 dark:hover:bg-gray-700 transition">
      Open (<%= @open_tasks.count %>)
    </button>
    <button id="filterInProgress" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-medium text-sm uppercase tracking-wider rounded hover:bg-gray-300 dark:hover:bg-gray-700 transition">
      In Progress (<%= @in_progress_tasks.count %>)
    </button>
    <button id="filterCompleted" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-medium text-sm uppercase tracking-wider rounded hover:bg-gray-300 dark:hover:bg-gray-700 transition">
      Completed (<%= @completed_tasks.count %>)
    </button>
  </div>

  <!-- Tasks Section -->
  <div class="mb-6">
    <h2 class="text-2xl font-black uppercase tracking-tight text-gray-900 dark:text-white mb-4">Created Tasks</h2>
  </div>

  <% if @tasks.any? %>
    <div class="space-y-4" id="tasksList">
      <% @tasks.each_with_index do |task, index| %>
        <%
          # Status badge colors
          status_colors = {
            'open' => {
              bg_class: 'bg-green-100 dark:bg-green-900/30',
              text_class: 'text-green-800 dark:text-green-400',
              text: 'Open'
            },
            'in_progress' => {
              bg_class: 'bg-blue-100 dark:bg-blue-900/30',
              text_class: 'text-blue-800 dark:text-blue-400',
              text: 'In Progress'
            },
            'completed' => {
              bg_class: 'bg-gray-100 dark:bg-gray-900/30',
              text_class: 'text-gray-800 dark:text-gray-400',
              text: 'Completed'
            }
          }
          status_config = status_colors[task.status] || {
            bg_class: 'bg-gray-100 dark:bg-gray-900/30',
            text_class: 'text-gray-800 dark:text-gray-400',
            text: task.status
          }

          # Cycle through accent colors with full class names
          accent_classes = [
            { bg: 'bg-emerald-100 dark:bg-emerald-900/30', text: 'text-emerald-700 dark:text-emerald-400' },
            { bg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-700 dark:text-blue-400' },
            { bg: 'bg-purple-100 dark:bg-purple-900/30', text: 'text-purple-700 dark:text-purple-400' },
            { bg: 'bg-orange-100 dark:bg-orange-900/30', text: 'text-orange-700 dark:text-orange-400' },
            { bg: 'bg-pink-100 dark:bg-pink-900/30', text: 'text-pink-700 dark:text-pink-400' },
            { bg: 'bg-indigo-100 dark:bg-indigo-900/30', text: 'text-indigo-700 dark:text-indigo-400' }
          ]
          accent = accent_classes[index % accent_classes.length]
        %>

        <div class="task-item bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:shadow-lg transition group" data-status="<%= task.status %>">
          <div class="p-6">
            <div class="flex items-start gap-6">
              <!-- Task Number / ID -->
              <div class="flex-shrink-0 w-16 h-16 <%= accent[:bg] %> <%= accent[:text] %> rounded-lg flex items-center justify-center font-mono text-xl font-bold">
                #<%= task.id %>
              </div>

              <!-- Task Content -->
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-4 mb-2">
                  <%= link_to task_path(task) do %>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white <%= info[:hover_class] %> transition cursor-pointer">
                      <%= task.title %>
                    </h3>
                  <% end %>
                  <span class="flex-shrink-0 px-3 py-1 <%= status_config[:bg_class] %> <%= status_config[:text_class] %> text-xs font-bold uppercase rounded-full">
                    <%= status_config[:text] %>
                  </span>
                </div>

                <p class="text-gray-700 dark:text-gray-300 mb-4 leading-relaxed">
                  <%= task.description %>
                </p>

                <div class="flex items-center gap-6 text-sm text-gray-500 dark:text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>‚¨ÜÔ∏è</span>
                    <span class="font-semibold"><%= task.upvotes_count %> upvotes</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <span>üí¨</span>
                    <span class="font-semibold"><%= task.submissions_count %> submissions</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <span>‚è±Ô∏è</span>
                    <span>Created <%= time_ago_in_words(task.created_at) %> ago</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-12 text-center">
      <div class="text-6xl mb-4">üìã</div>
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">No tasks created yet</h3>
      <p class="text-gray-600 dark:text-gray-400 mb-6">
        <% if user_signed_in? && current_user.id == @user.id %>
          Start creating challenges for the community!
        <% else %>
          This user hasn't created any tasks yet.
        <% end %>
      </p>
      <% if user_signed_in? && current_user.id == @user.id %>
        <%= link_to new_task_path, class: "px-6 py-3 bg-emerald-500 text-black font-bold text-sm uppercase tracking-wider hover:bg-emerald-400 transition rounded" do %>
          + Create First Task
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- Back to Community Link -->
  <div class="mt-8 text-center">
    <%= link_to "‚Üê Back to Community", users_path, class: "inline-flex items-center gap-2 #{info[:text_class]} #{info[:text_class_dark]} #{info[:hover_class]} font-medium transition" %>
  </div>

  <script>
    function initializeProfileFilters() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const taskItems = document.querySelectorAll('.task-item');

      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Update button states
          filterButtons.forEach(btn => {
            btn.classList.remove('active', 'bg-gray-900', 'dark:bg-gray-700', 'text-white');
            btn.classList.add('bg-gray-200', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300');
          });

          this.classList.add('active', 'bg-gray-900', 'dark:bg-gray-700', 'text-white');
          this.classList.remove('bg-gray-200', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300');

          // Get filter type from button id
          const filterType = this.id.replace('filter', '').toLowerCase();

          // Filter tasks
          taskItems.forEach(task => {
            if (filterType === 'all') {
              task.style.display = '';
            } else {
              const taskStatus = task.getAttribute('data-status');
              if (filterType === 'inprogress') {
                task.style.display = taskStatus === 'in_progress' ? '' : 'none';
              } else {
                task.style.display = taskStatus === filterType ? '' : 'none';
              }
            }
          });
        });
      });
    }

    // Initialize on initial page load
    initializeProfileFilters();

    // Re-initialize after Turbo Drive navigation
    document.addEventListener('turbo:load', initializeProfileFilters);
  </script>
</div>
