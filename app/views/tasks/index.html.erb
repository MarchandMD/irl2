<div class="w-full">
  <!-- Header Section -->
  <div class="mb-8">
    <h1 class="text-4xl font-black uppercase tracking-tight text-gray-900 dark:text-white mb-2">Tasks</h1>
    <p class="text-gray-600 dark:text-gray-400 text-lg">Browse and discover real-world challenges</p>
  </div>

  <!-- Search Bar -->
  <div class="mb-6" data-controller="task-search" data-task-search-url-value="<%= tasks_path %>">
    <div class="relative">
      <input
        type="text"
        placeholder="Search tasks by title, description, or creator..."
        value="<%= params[:q] %>"
        data-task-search-target="input"
        data-action="input->task-search#search keydown->task-search#handleKeydown"
        class="w-full px-4 py-3 pl-12 pr-12 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent text-base"
      />
      <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 pointer-events-none">
        üîç
      </div>
      <button
        type="button"
        data-task-search-target="clearButton"
        data-action="click->task-search#clear"
        class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition <%= 'hidden' unless params[:q].present? %>"
      >
        ‚úï
      </button>
    </div>
  </div>

  <!-- Filter Bar -->
  <div class="mb-8 flex flex-wrap items-center gap-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800" data-controller="task-filter" data-task-filter-url-value="<%= tasks_path %>">
    <div class="flex items-center gap-2">
      <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide">Sort:</label>
      <select data-task-filter-target="sortSelect" data-action="change->task-filter#updateFilters" class="px-3 py-2 border border-gray-300 dark:border-gray-700 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="newest" <%= 'selected' if params[:sort].blank? || params[:sort] == 'newest' %>>Newest</option>
        <option value="popular" <%= 'selected' if params[:sort] == 'popular' %>>Most Popular</option>
        <option value="active" <%= 'selected' if params[:sort] == 'active' %>>Most Active</option>
      </select>
    </div>

    <div class="flex items-center gap-2">
      <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide">Status:</label>
      <select data-task-filter-target="statusSelect" data-action="change->task-filter#updateFilters" class="px-3 py-2 border border-gray-300 dark:border-gray-700 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="all" <%= 'selected' if params[:status].blank? || params[:status] == 'all' %>>All Tasks</option>
        <option value="open" <%= 'selected' if params[:status] == 'open' %>>Open</option>
        <option value="in_progress" <%= 'selected' if params[:status] == 'in_progress' %>>In Progress</option>
        <option value="completed" <%= 'selected' if params[:status] == 'completed' %>>Completed</option>
      </select>
    </div>

    <div class="flex items-center gap-2 ml-auto">
      <%= link_to new_task_path, class: "px-4 py-2 bg-emerald-500 text-black font-bold text-sm uppercase tracking-wider hover:bg-emerald-400 transition rounded" do %>
        + Create Task
      <% end %>
    </div>
  </div>

  <!-- Task Stats -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
      <div class="text-3xl font-black text-emerald-600 dark:text-emerald-400"><%= @active_tasks_count %></div>
      <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide">Active Tasks</div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
      <div class="text-3xl font-black text-blue-600 dark:text-blue-400"><%= @in_progress_count %></div>
      <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide">In Progress</div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
      <div class="text-3xl font-black text-purple-600 dark:text-purple-400"><%= @completed_count %></div>
      <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide">Completed</div>
    </div>
  </div>

  <!-- Search Results Indicator -->
  <% if params[:q].present? %>
    <div class="mb-6 flex items-center justify-between p-4 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üîç</span>
        <div>
          <p class="text-sm font-semibold text-gray-900 dark:text-white">
            Showing search results for: <span class="text-emerald-600 dark:text-emerald-400">"<%= params[:q] %>"</span>
          </p>
          <p class="text-xs text-gray-600 dark:text-gray-400">
            <%= @tasks.count %> <%= 'task'.pluralize(@tasks.count) %> found
          </p>
        </div>
      </div>
      <%= link_to tasks_path(group: params[:group]), class: "px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium text-sm uppercase tracking-wide rounded transition" do %>
        Clear Search
      <% end %>
    </div>
  <% end %>

  <!-- Group Filters -->
  <div class="mb-6 flex items-center gap-4 flex-wrap">
    <%= link_to tasks_path(q: params[:q], sort: params[:sort], status: params[:status]), class: "px-4 py-2 #{'bg-gray-900 dark:bg-gray-700 text-white' if params[:group].blank?} #{'bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-700' if params[:group].present?} font-medium text-sm uppercase tracking-wider rounded transition", data: { turbo_frame: "tasks_list" } do %>
      All Groups
    <% end %>
    <%= link_to tasks_path(group: 'Urban Nomads', q: params[:q], sort: params[:sort], status: params[:status]), class: "px-4 py-2 #{'bg-emerald-600 dark:bg-emerald-700 text-white' if params[:group] == 'Urban Nomads'} #{'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-400 hover:bg-emerald-200 dark:hover:bg-emerald-900/50' if params[:group] != 'Urban Nomads'} font-medium text-sm uppercase tracking-wider rounded transition", data: { turbo_frame: "tasks_list" } do %>
      Urban Nomads
    <% end %>
    <%= link_to tasks_path(group: 'Digital Alchemists', q: params[:q], sort: params[:sort], status: params[:status]), class: "px-4 py-2 #{'bg-purple-600 dark:bg-purple-700 text-white' if params[:group] == 'Digital Alchemists'} #{'bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-400 hover:bg-purple-200 dark:hover:bg-purple-900/50' if params[:group] != 'Digital Alchemists'} font-medium text-sm uppercase tracking-wider rounded transition", data: { turbo_frame: "tasks_list" } do %>
      Digital Alchemists
    <% end %>
    <%= link_to tasks_path(group: 'Street Philosophers', q: params[:q], sort: params[:sort], status: params[:status]), class: "px-4 py-2 #{'bg-blue-600 dark:bg-blue-700 text-white' if params[:group] == 'Street Philosophers'} #{'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-900/50' if params[:group] != 'Street Philosophers'} font-medium text-sm uppercase tracking-wider rounded transition", data: { turbo_frame: "tasks_list" } do %>
      Street Philosophers
    <% end %>
    <%= link_to tasks_path(group: 'Midnight Architects', q: params[:q], sort: params[:sort], status: params[:status]), class: "px-4 py-2 #{'bg-indigo-600 dark:bg-indigo-700 text-white' if params[:group] == 'Midnight Architects'} #{'bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-400 hover:bg-indigo-200 dark:hover:bg-indigo-900/50' if params[:group] != 'Midnight Architects'} font-medium text-sm uppercase tracking-wider rounded transition", data: { turbo_frame: "tasks_list" } do %>
      Midnight Architects
    <% end %>
    <%= link_to tasks_path(group: 'Concrete Poets', q: params[:q], sort: params[:sort], status: params[:status]), class: "px-4 py-2 #{'bg-orange-600 dark:bg-orange-700 text-white' if params[:group] == 'Concrete Poets'} #{'bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 hover:bg-orange-200 dark:hover:bg-orange-900/50' if params[:group] != 'Concrete Poets'} font-medium text-sm uppercase tracking-wider rounded transition", data: { turbo_frame: "tasks_list" } do %>
      Concrete Poets
    <% end %>
  </div>

  <%= render "tasks_list" %>
</div>
